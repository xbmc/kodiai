---
phase: 80-slack-operator-hardening
plan: 03
type: execute
wave: 2
depends_on: [80-01, 80-02]
files_modified:
  - package.json
  - docs/runbooks/slack-integration.md
  - docs/runbooks/xbmc-ops.md
autonomous: true

must_haves:
  truths:
    - "Runbook documents Slack integration deployment flow, required environment variables, and incident debugging steps"
    - "Operators can run explicit smoke and regression commands from the runbook without guesswork"
    - "Slack incident triage maps directly from observable symptoms to concrete checks and code pointers"
  artifacts:
    - path: "docs/runbooks/slack-integration.md"
      provides: "Slack v1 operator runbook with deployment, env var, smoke/regression, and incident triage procedures"
      contains: "SLACK_SIGNING_SECRET"
    - path: "package.json"
      provides: "First-class script aliases for phase80 smoke and regression verification commands"
      contains: "verify:phase80:smoke"
    - path: "docs/runbooks/xbmc-ops.md"
      provides: "Cross-link to Slack runbook from primary ops playbook"
      contains: "slack"
  key_links:
    - from: "package.json"
      to: "scripts/phase80-slack-smoke.ts"
      via: "Script alias executes deterministic smoke verifier"
      pattern: "verify:phase80:smoke"
    - from: "package.json"
      to: "scripts/phase80-slack-regression-gate.ts"
      via: "Script alias executes Slack regression gate"
      pattern: "verify:phase80:regression"
    - from: "docs/runbooks/slack-integration.md"
      to: "src/routes/slack-events.ts"
      via: "Incident debugging links operational symptoms to ingress verification and routing rails"
      pattern: "slack-events|safety-rails|assistant-handler"
---

<objective>
Publish the Slack operator runbook and command wiring needed for repeatable deployment and incident response.

Purpose: SLK-06 is not complete until operators can both verify behavior and quickly debug production incidents using documented, deterministic procedures.
Output: New Slack integration runbook, ops playbook cross-link, and package script aliases for smoke/regression execution.
</objective>

<execution_context>
@/home/keith/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/keith/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/79-slack-read-only-assistant-routing/79-USER-SETUP.md
@docs/smoke/phase80-slack-operator-hardening.md
@docs/runbooks/review-requested-debug.md
@docs/runbooks/xbmc-ops.md
@deployment.md
@src/routes/slack-events.ts
@src/slack/safety-rails.ts
@src/slack/assistant-handler.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Slack integration operator runbook with deployment, env vars, and incident triage</name>
  <files>docs/runbooks/slack-integration.md</files>
  <action>
Create a dedicated runbook for Slack v1 operations:

- Document deployment steps and preflight checks specific to Slack integration rollout (including scope preflight expectations and rollback notes).
- List required environment variables with source-of-truth locations and failure symptoms (`SLACK_SIGNING_SECRET`, `SLACK_BOT_TOKEN`, `SLACK_BOT_USER_ID`, `SLACK_KODIAI_CHANNEL_ID`, and relevant assistant/runtime settings already in config).
- Include incident triage sections for: signature failures, ignored events, missing thread replies, reaction add/remove failures, and ambiguous repo clarifications.
- Map each incident type to concrete logs, commands, and code pointers so operators can isolate cause quickly.
- Reference both Phase 80 smoke and regression commands as mandatory verification steps after deploy and after incident fixes.
  </action>
  <verify>
Manually read `docs/runbooks/slack-integration.md` and confirm deployment, env var, and incident sections exist with concrete commands/checks.
  </verify>
  <done>
Slack integration now has an operator-ready runbook covering deployment, configuration, and incident debugging with deterministic verification steps.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire package scripts and cross-link Slack runbook in primary ops playbook</name>
  <files>package.json, docs/runbooks/xbmc-ops.md</files>
  <action>
Make Slack verification commands and docs discoverable from standard operator entry points:

- Add `verify:phase80:smoke` and `verify:phase80:regression` script aliases in `package.json` targeting the Phase 80 verifier scripts.
- Update `docs/runbooks/xbmc-ops.md` with a concise Slack section or pointer to `docs/runbooks/slack-integration.md` so incident responders reach Slack guidance from the main ops runbook.
- Keep updates additive and minimal; do not alter unrelated ops flows.
  </action>
  <verify>
Run `bun run verify:phase80:smoke --help`.
Run `bun run verify:phase80:regression --help`.
Manually confirm `docs/runbooks/xbmc-ops.md` links to the Slack runbook.
  </verify>
  <done>
Operators can discover and run Slack smoke/regression checks through standard package scripts and ops documentation without tribal knowledge.
  </done>
</task>

</tasks>

<verification>
- `bun run verify:phase80:smoke --help` and `bun run verify:phase80:regression --help` both resolve and print usage.
- `docs/runbooks/slack-integration.md` covers deployment, env vars, smoke/regression validation, and incident debugging with code pointers.
- `docs/runbooks/xbmc-ops.md` includes a clear path to Slack troubleshooting guidance.
</verification>

<success_criteria>
Slack v1 operational hardening is documented and runnable: deployment/config guidance is explicit, incident triage is actionable, and smoke/regression commands are first-class operator workflows.
</success_criteria>

<output>
After completion, create `.planning/phases/80-slack-operator-hardening/80-03-SUMMARY.md`
</output>
