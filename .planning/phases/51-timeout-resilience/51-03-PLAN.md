---
phase: 51-timeout-resilience
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/errors.test.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "errors.test.ts includes timeout_partial in the categories array and expectedHeaders object"
    - "classifyError returns timeout_partial when isTimeout=true and published=true"
    - "formatErrorComment produces correct output for timeout_partial category"
  artifacts:
    - path: "src/lib/errors.test.ts"
      provides: "timeout_partial test coverage"
      contains: "timeout_partial"
---

<objective>
Fix test gap: add timeout_partial coverage to errors.test.ts.

Purpose: The verification report found that errors.test.ts was not updated when timeout_partial was added to ErrorCategory. The expectedHeaders Record<ErrorCategory, string> is missing the new category, causing TypeScript compilation failure. This plan adds the missing test coverage.
</objective>

<execution_context>
@/home/keith/.claude/get-shit-done/workflows/execute-plan.md
@/home/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/51-timeout-resilience/51-VERIFICATION.md
@src/lib/errors.ts
@src/lib/errors.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add timeout_partial test coverage to errors.test.ts</name>
  <files>src/lib/errors.test.ts</files>
  <action>
Make four changes to `src/lib/errors.test.ts`:

1. **Add `timeout_partial` to the categories array** (line 80-86): Add `"timeout_partial"` after `"timeout"` in the array.

2. **Add `timeout_partial` to expectedHeaders** (line 89-95): Add `timeout_partial: "Kodiai completed a partial review"` to the Record.

3. **Add classifyError test for timeout_partial**: In the `classifyError` describe block, add a test:
```typescript
test("returns 'timeout_partial' when isTimeout is true and published is true", () => {
  expect(classifyError(new Error("some error"), true, true)).toBe("timeout_partial");
  expect(classifyError(new Error("clone failed"), true, true)).toBe("timeout_partial");
});
```

4. **Add formatErrorComment test for timeout_partial**: In the `formatErrorComment` describe block, add a test:
```typescript
test("includes suggestion for timeout_partial", () => {
  const result = formatErrorComment("timeout_partial", "detail");
  expect(result).toContain("partial review");
  expect(result).toContain("inline comments");
});
```
  </action>
  <verify>Run `npx tsc --noEmit` -- no type errors. Run `npx vitest run src/lib/errors.test.ts` -- all tests pass including new timeout_partial tests.</verify>
  <done>errors.test.ts has full timeout_partial coverage: categories array, expectedHeaders, classifyError with published=true, and formatErrorComment output verification.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- `npx vitest run src/lib/errors.test.ts` -- all tests pass
- The expectedHeaders Record<ErrorCategory, string> includes all 6 categories
</verification>

<success_criteria>
- TypeScript compilation passes (no missing timeout_partial in Record)
- classifyError(error, true, true) returns "timeout_partial"
- formatErrorComment("timeout_partial", detail) produces correct partial review messaging
- All existing tests continue to pass
</success_criteria>

<output>
After completion, create `.planning/phases/51-timeout-resilience/51-03-SUMMARY.md`
</output>
