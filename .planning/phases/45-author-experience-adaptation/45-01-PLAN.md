---
phase: 45-author-experience-adaptation
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/lib/author-classifier.ts
  - src/lib/author-classifier.test.ts
  - src/execution/review-prompt.ts
  - src/execution/review-prompt.test.ts
autonomous: true

must_haves:
  truths:
    - "MEMBER and OWNER author_association values always classify as core tier"
    - "FIRST_TIMER and FIRST_TIME_CONTRIBUTOR always classify as first-time tier"
    - "NONE without PR count defaults to first-time (conservative)"
    - "COLLABORATOR/CONTRIBUTOR without PR count defaults to regular"
    - "PR count enrichment overrides ambiguous associations (<=1 first-time, 2-9 regular, >=10 core)"
    - "MANNEQUIN is treated identically to NONE"
    - "buildAuthorExperienceSection returns educational tone directives for first-time tier"
    - "buildAuthorExperienceSection returns terse tone directives for core tier"
    - "buildAuthorExperienceSection returns empty string for regular tier"
  artifacts:
    - path: "src/lib/author-classifier.ts"
      provides: "classifyAuthor function and AuthorTier/AuthorClassification types"
      exports: ["classifyAuthor", "AuthorTier", "AuthorClassification"]
    - path: "src/lib/author-classifier.test.ts"
      provides: "Unit tests for classification mapping"
    - path: "src/execution/review-prompt.ts"
      provides: "buildAuthorExperienceSection function"
      exports: ["buildAuthorExperienceSection"]
  key_links:
    - from: "src/lib/author-classifier.ts"
      to: "src/execution/review-prompt.ts"
      via: "AuthorTier type consumed by buildAuthorExperienceSection"
      pattern: "import.*AuthorTier.*from.*author-classifier"
---

<objective>
TDD: Implement the deterministic author classification logic and prompt tone section builder.

Purpose: Establish the pure-function core of author experience adaptation with full test coverage before wiring into the review pipeline. Classification maps author_association + optional PR count into three tiers (first-time, regular, core). The prompt section builder emits tier-specific tone directives.

Output: Tested classification module and prompt section builder ready for integration.
</objective>

<execution_context>
@/home/keith/.claude/get-shit-done/workflows/execute-plan.md
@/home/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/45-author-experience-adaptation/45-RESEARCH.md
@src/lib/auto-profile.ts
@src/lib/auto-profile.test.ts
@src/execution/review-prompt.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: TDD author classifier -- RED then GREEN</name>
  <files>src/lib/author-classifier.ts, src/lib/author-classifier.test.ts</files>
  <action>
Create `src/lib/author-classifier.test.ts` with tests for `classifyAuthor()`:

**Types to export from `src/lib/author-classifier.ts`:**
```typescript
export type AuthorTier = "first-time" | "regular" | "core";
export type AuthorClassification = {
  tier: AuthorTier;
  authorAssociation: string;
  prCount: number | null;
  cachedAt: string | null;
};
```

**Test cases for `classifyAuthor({ authorAssociation, prCount? })`:**

Definite mappings (no PR count needed):
- `MEMBER` -> `core`
- `OWNER` -> `core`
- `FIRST_TIMER` -> `first-time`
- `FIRST_TIME_CONTRIBUTOR` -> `first-time`

Ambiguous associations WITHOUT PR count:
- `COLLABORATOR` -> `regular`
- `CONTRIBUTOR` -> `regular`
- `NONE` -> `first-time`
- `MANNEQUIN` -> `first-time`

Ambiguous associations WITH PR count enrichment:
- `NONE` + prCount=0 -> `first-time`
- `NONE` + prCount=1 -> `first-time`
- `NONE` + prCount=2 -> `regular`
- `NONE` + prCount=9 -> `regular`
- `NONE` + prCount=10 -> `core`
- `NONE` + prCount=50 -> `core`
- `COLLABORATOR` + prCount=0 -> `first-time`
- `COLLABORATOR` + prCount=5 -> `regular`
- `COLLABORATOR` + prCount=15 -> `core`
- `CONTRIBUTOR` + prCount=1 -> `first-time`

Definite associations IGNORE PR count:
- `MEMBER` + prCount=0 -> `core` (MEMBER always core regardless of count)
- `FIRST_TIMER` + prCount=50 -> `first-time` (FIRST_TIMER always first-time regardless of count)

Unknown/unexpected association value:
- `UNKNOWN_VALUE` without PR count -> `first-time` (conservative default)

**RED phase:** Write all tests, run `bun test src/lib/author-classifier.test.ts` -- must FAIL.

**GREEN phase:** Implement `classifyAuthor()` in `src/lib/author-classifier.ts`:
1. MEMBER/OWNER -> return `core` immediately
2. FIRST_TIMER/FIRST_TIME_CONTRIBUTOR -> return `first-time` immediately
3. If prCount is a number (not null/undefined): <=1 first-time, 2-9 regular, >=10 core
4. COLLABORATOR/CONTRIBUTOR without prCount -> `regular`
5. Everything else (NONE, MANNEQUIN, unknown) -> `first-time`

Run tests again -- all must PASS.
  </action>
  <verify>`bun test src/lib/author-classifier.test.ts` -- all tests pass</verify>
  <done>classifyAuthor maps all 8 author_association values + PR count combinations to the correct tier, with 15+ test cases passing</done>
</task>

<task type="auto">
  <name>Task 2: TDD prompt section builder -- RED then GREEN</name>
  <files>src/execution/review-prompt.ts, src/execution/review-prompt.test.ts</files>
  <action>
Add `buildAuthorExperienceSection()` to `src/execution/review-prompt.ts` and test it.

**Add tests to the EXISTING `src/execution/review-prompt.test.ts`** (do NOT create a new test file):

Test cases for `buildAuthorExperienceSection({ tier, authorLogin })`:
- tier="first-time", authorLogin="newdev" -> returns non-empty string containing:
  - "Author Experience Context" heading
  - "first-time" or "new contributor" language
  - "encouraging" or "welcoming" directive
  - "explain WHY" directive
  - "learning opportunities" directive
  - the authorLogin "newdev" somewhere in the output
- tier="core", authorLogin="maintainer" -> returns non-empty string containing:
  - "Author Experience Context" heading
  - "core contributor" or "MEMBER/OWNER" language
  - "concise" directive
  - "terse" directive
  - the authorLogin "maintainer" somewhere in the output
- tier="regular", authorLogin="someone" -> returns empty string ""

**RED phase:** Write tests, run `bun test src/execution/review-prompt.test.ts` -- new tests must FAIL.

**GREEN phase:** Add `buildAuthorExperienceSection()` as an exported function in `src/execution/review-prompt.ts`. Follow the exact prompt text from the research (Pattern 3). Import `AuthorTier` from `../lib/author-classifier.ts`.

Do NOT wire into `buildReviewPrompt()` yet -- that happens in plan 02. This task only creates and tests the standalone section builder function.

Run tests -- all must PASS (both new and existing).
  </action>
  <verify>`bun test src/execution/review-prompt.test.ts` -- all tests pass (new + existing)</verify>
  <done>buildAuthorExperienceSection returns tier-appropriate tone directives: educational for first-time, terse for core, empty for regular. All review-prompt tests pass.</done>
</task>

</tasks>

<verification>
- `bun test src/lib/author-classifier.test.ts` -- all pass
- `bun test src/execution/review-prompt.test.ts` -- all pass (new + existing)
- `bun test` -- full suite green (no regressions)
- `classifyAuthor` exported from `src/lib/author-classifier.ts`
- `buildAuthorExperienceSection` exported from `src/execution/review-prompt.ts`
- `AuthorTier` and `AuthorClassification` types exported
</verification>

<success_criteria>
Classification module maps all 8 author_association values correctly with and without PR count enrichment. Prompt section builder emits appropriate tone directives per tier. All tests pass with zero regressions.
</success_criteria>

<output>
After completion, create `.planning/phases/45-author-experience-adaptation/45-01-SUMMARY.md`
</output>
