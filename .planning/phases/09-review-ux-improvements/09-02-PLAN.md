---
phase: 09-review-ux-improvements
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/execution/review-prompt.ts
autonomous: true

must_haves:
  truths:
    - "Each PR auto-review includes a structured summary comment showing what changed, why, and which files were modified"
    - "The summary comment is posted BEFORE inline review comments so it appears at the top of the PR conversation"
    - "Trivial PRs (fewer than 3 files, under 50 lines) get a short 2-3 line summary"
    - "The summary uses <details> tags when longer than 500 characters"
  artifacts:
    - path: "src/execution/review-prompt.ts"
      provides: "Review prompt with structured summary comment instructions"
      contains: "create_comment"
  key_links:
    - from: "src/execution/review-prompt.ts"
      to: "mcp__github_comment__create_comment"
      via: "prompt instruction to post summary comment"
      pattern: "mcp__github_comment__create_comment"
---

<objective>
Add structured PR summary comment to the review prompt so each auto-review includes a high-level overview of what changed, why, and which files were modified.

Purpose: Give PR authors and reviewers an immediate high-level understanding of the changes (UX-01). The summary comment appears before any inline review comments in the conversation timeline.
Output: Updated review prompt with summary comment instructions.
</objective>

<execution_context>
@/home/keith/.claude/get-shit-done/workflows/execute-plan.md
@/home/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-review-ux-improvements/09-RESEARCH.md
@src/execution/review-prompt.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace "no summary" rule with structured summary instructions in review prompt</name>
  <files>
    src/execution/review-prompt.ts
  </files>
  <action>
In `src/execution/review-prompt.ts`, modify the `buildReviewPrompt()` function to replace the current "After review" section with summary comment instructions.

**1. Replace the "After review" section (currently lines 99-106):**

The current text is:
```
## After review

If you found issues: post inline comments using the MCP tool. Do NOT post a summary comment.
If NO issues found: do nothing. Do NOT post any comment or approval -- the system handles silent approval automatically.
```

Replace with:
```
## Summary comment

FIRST, before posting any inline comments, post ONE summary comment on the PR using the `mcp__github_comment__create_comment` tool with issue number ${context.prNumber}.

Use this structure:

### Summary

**What changed:** [1-3 sentence high-level description of what the PR does]

**Why:** [Inferred purpose or motivation for the changes]

**Files modified:**
- `file1.ts` -- [brief description]
- `file2.ts` -- [brief description]
[...list all changed files with one-line descriptions]

Rules for the summary:
- Keep it concise and factual
- If the PR is trivial (fewer than 3 files, under 50 lines changed), keep the entire summary to 2-3 lines
- If the summary would exceed 500 characters, wrap it in `<details>` tags:
  <details>
  <summary>PR Summary</summary>

  [summary content]

  </details>
- Post this summary BEFORE any inline review comments so it appears first in the conversation

## After review

If you found issues: post the summary comment first, then post inline comments using the MCP tool.
If NO issues found: post the summary comment, then do nothing else. Do NOT post any approval -- the system handles silent approval automatically.
```

**2. Also update the Rules section** (currently lines 88-97):

Change the line:
```
'- NO positive feedback, NO "looks good", NO summary comments',
```
to:
```
'- NO positive feedback, NO "looks good" -- but DO post exactly one summary comment as instructed below',
```

This removes the contradiction where the old rules prohibited summary comments while the new section requires one (Pitfall 4 from research).
  </action>
  <verify>
Run `bun build --no-bundle src/execution/review-prompt.ts --outdir /tmp/check` -- compiles without errors.
Grep for "create_comment" in review-prompt.ts to confirm summary comment tool instruction is present.
Grep for "Summary" in review-prompt.ts to confirm structured format is present.
Verify the "Do NOT post a summary comment" line is REMOVED.
  </verify>
  <done>
Review prompt instructs Claude to post a structured summary comment (what/why/files) using create_comment MCP tool BEFORE inline comments. Trivial PR handling included. `<details>` wrapping instruction for long summaries. Old "no summary" rule replaced. Compiles cleanly.
  </done>
</task>

</tasks>

<verification>
1. `bun build --no-bundle src/execution/review-prompt.ts --outdir /tmp/check` -- compiles
2. The phrase "Do NOT post a summary comment" does NOT appear in review-prompt.ts
3. The phrase "create_comment" appears in the summary instructions
4. The phrase "What changed" and "Why" and "Files modified" appear in the prompt template
5. Instructions say to post summary BEFORE inline comments
6. Trivial PR handling (fewer than 3 files, under 50 lines) is specified
7. `<details>` wrapping instruction for long summaries is present
</verification>

<success_criteria>
- review-prompt.ts instructs Claude to post a structured summary comment with what/why/files sections
- Summary is posted FIRST (before inline comments) via create_comment MCP tool
- Trivial PRs get short 2-3 line summaries
- Long summaries use `<details>` tags
- The old "Do NOT post a summary comment" rule is removed
- The Rules section no longer prohibits summary comments
- File compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-review-ux-improvements/09-02-SUMMARY.md`
</output>
