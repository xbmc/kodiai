---
phase: 84-azure-deployment-health-verify-embeddings-voyageai-work-on-deploy-and-fix-container-log-errors
plan: 02
type: execute
wave: 2
depends_on: ["84-01"]
files_modified: []
autonomous: false
requirements: []
must_haves:
  truths:
    - "VoyageAI embeddings confirmed working in deployed Azure environment"
    - "Container starts cleanly with no error-level output on boot"
    - "Runtime warnings are documented if any remain"
  artifacts: []
  key_links: []
---

<objective>
Deploy to Azure, verify embeddings smoke test passes, and triage container log errors.

Purpose: Confirm the deployed environment is healthy -- VoyageAI works, startup is clean, and any log errors are triaged and fixed (critical) or documented (cosmetic).

Output: Healthy deployment with confirmed embeddings, clean startup logs.
</objective>

<execution_context>
@/home/keith/.claude/get-shit-done/workflows/execute-plan.md
@/home/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/84-azure-deployment-health-verify-embeddings-voyageai-work-on-deploy-and-fix-container-log-errors/84-01-SUMMARY.md
@deploy.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Deploy to Azure and capture container logs</name>
  <files></files>
  <action>
Run the deployment and capture logs for investigation:

1. Run `./deploy.sh` from the project root to deploy the latest code (which now includes the smoke test from Plan 01 and the updated env vars)
2. Wait 30-60 seconds for the container to start and stabilize
3. Pull container logs using Azure CLI:
   ```bash
   az containerapp logs show --name ca-kodiai --resource-group rg-kodiai --type console --follow false --tail 200
   ```
4. Also check system logs for any Azure-level errors:
   ```bash
   az containerapp logs show --name ca-kodiai --resource-group rg-kodiai --type system --follow false --tail 50
   ```
5. Save the full log output for triage analysis

Key things to look for in logs:
- "Embeddings smoke test passed" (confirms VoyageAI works) vs "failed" (needs investigation)
- Any ERROR-level log lines on startup
- Any unhandled promise rejections or crash loops
- Slack scope preflight result
- GitHub App initialization success
  </action>
  <verify>Deployment completes successfully (deploy.sh exits 0). Container logs are captured and available for analysis.</verify>
  <done>App is deployed to Azure with all env vars, container logs are captured for triage.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify deployment health and triage logs</name>
  <files></files>
  <action>Checkpoint: verify deployment health from captured logs.</action>
  <what-built>Deployed the app to Azure with embeddings smoke test and all environment variables. Captured container logs for triage.</what-built>
  <how-to-verify>
1. Check the deployment output -- did deploy.sh succeed?
2. Review the container logs -- look for:
   - "Embeddings smoke test passed" or "failed" line
   - Any ERROR-level lines on startup
   - Overall startup health
3. If critical errors found: describe them so they can be fixed
4. If embeddings smoke test failed: investigate VOYAGE_API_KEY configuration
5. Hit the health endpoint to confirm the app is responding:
   ```bash
   curl https://ca-kodiai.*.azurecontainerapps.io/health
   ```
  </how-to-verify>
  <resume-signal>Type "clean" if startup is clean, or describe any critical errors that need fixing</resume-signal>
</task>

</tasks>

<verification>
1. deploy.sh completes without error
2. Container logs show "Embeddings smoke test passed"
3. No ERROR-level lines in startup logs
4. /health endpoint returns 200
5. Any remaining warnings are cosmetic and documented
</verification>

<success_criteria>
- VoyageAI confirmed working in deployed environment (smoke test passes)
- Clean startup with no error-level output on boot
- Runtime warnings (if any) are documented and acceptable
</success_criteria>

<output>
After completion, create `.planning/phases/84-azure-deployment-health-verify-embeddings-voyageai-work-on-deploy-and-fix-container-log-errors/84-02-SUMMARY.md`
</output>
