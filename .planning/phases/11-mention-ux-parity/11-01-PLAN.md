---
phase: 11-mention-ux-parity
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/execution/config.ts
  - src/execution/config.test.ts
  - src/handlers/mention-types.ts
  - src/handlers/mention.ts
  - src/handlers/mention-types.test.ts
autonomous: true

must_haves:
  truths:
    - "@claude is accepted as an alias for @kodiai by default"
    - "A repo can opt out of @claude aliasing via .kodiai.yml"
    - "Mentions that contain no question after stripping do not produce a reply"
  artifacts:
    - path: "src/execution/config.ts"
      provides: "Repo config schema includes mention.acceptClaudeAlias"
      contains: "acceptClaudeAlias"
    - path: "src/handlers/mention-types.ts"
      provides: "Mention detection supports @kodiai and optionally @claude"
      contains: "containsMention"
    - path: "src/handlers/mention-types.test.ts"
      provides: "Unit tests for mention parsing, alias, and stripping"
  key_links:
    - from: "src/handlers/mention.ts"
      to: "src/execution/config.ts"
      via: "loadRepoConfig controls alias behavior"
      pattern: "acceptClaudeAlias|loadRepoConfig"
---

<objective>
Enable global @claude alias support for mention triggers, with a per-repo opt-out. Ensure empty/ack-only mentions do not create reply comments.

Purpose: Replace @claude GitHub Actions mentions without retraining dev muscle memory.
Output: Config-driven aliasing, robust mention parsing/stripping, and tests.
</objective>

<execution_context>
@/home/keith/.claude/get-shit-done/workflows/execute-plan.md
@/home/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@src/execution/config.ts
@src/handlers/mention-types.ts
@src/handlers/mention.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add mention.acceptClaudeAlias config (default true)</name>
  <files>src/execution/config.ts, src/execution/config.test.ts</files>
  <action>
  1) Extend the repo config schema with:

     - `mention.acceptClaudeAlias: boolean` (default: `true`)

  2) Add config tests proving:
     - Missing mention block -> alias defaults to true
     - Explicit `mention.acceptClaudeAlias: false` is accepted and disables alias
     - Unknown keys remain rejected (keep strict behavior where applicable)
  </action>
  <verify>
  - `bun test src/execution/config.test.ts`
  </verify>
  <done>
  Config supports a global alias default with a repo-level safety valve.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement alias-aware mention detection and stripping</name>
  <files>src/handlers/mention-types.ts, src/handlers/mention.ts, src/handlers/mention-types.test.ts</files>
  <action>
  1) Update mention parsing utilities to support multiple accepted handles:
     - Always accept `@${appSlug}` (e.g. `@kodiai`)
     - Optionally accept `@claude` when `mention.acceptClaudeAlias` is true

  Guidance:
  - Use word-boundary safe matching (`@claude\b`, `@kodiai\b`) to avoid triggering on `@claude123`.
  - Keep case-insensitive behavior.
  - Update stripping to remove all accepted handles from the body.

  2) Wire config into mention handling:
     - Load repo config and decide accepted handles
     - If the stripped question is empty/whitespace -> skip execution (do not reply)

  3) Add tests in `src/handlers/mention-types.test.ts`:
     - containsMention detects @kodiai
     - containsMention detects @claude only when alias enabled
     - stripMention removes @kodiai, @claude, and both
     - empty mention yields empty string and handler skips
  </action>
  <verify>
  - `bun test src/handlers/mention-types.test.ts`
  - Manual spot-check: mention handler logs a skip when question is empty
  </verify>
  <done>
  @claude triggers Kodiai mention handling by default, but can be disabled per repo.
  </done>
</task>

</tasks>

<verification>
- `bun test src/execution/config.test.ts src/handlers/mention-types.test.ts`
</verification>

<success_criteria>
- @claude alias works by default and is config-disableable
- Empty/ack-only mentions do not generate reply comments
- Tests cover detection/stripping and config defaults
</success_criteria>

<output>
After execution, create `.planning/phases/11-mention-ux-parity/11-01-SUMMARY.md`
</output>
