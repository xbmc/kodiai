---
phase: 17-write-mode-reliability
plan: 02
type: execute
wave: 2
depends_on:
  - 17-write-mode-reliability/17-01-SUMMARY.md
  - 16-write-guardrails/16-01-SUMMARY.md
files_modified:
  - src/handlers/mention.ts
  - src/handlers/mention.test.ts
  - src/jobs/workspace.ts
  - docs/runbooks/mentions.md
autonomous: true
---

<objective>
Improve write-mode reliability for private single-replica usage by focusing on user-visible clarity and safer behavior under expected failures, without adding distributed infrastructure.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: failure UX tightening for write-mode</name>
  <files>src/handlers/mention.ts src/handlers/mention.test.ts</files>
  <action>
  Ensure write failures produce short, actionable refusal/error responses that clearly include:
  - stable reason code
  - triggering path/rule when available
  - smallest safe next action (or explicit no-safe-bypass)
  Keep responses concise and aligned with current decision-only style.
  </action>
  <verify>
  - Unit tests cover deny path, allowlist mismatch, secret detection, and generic write failures.
  </verify>
</task>

<task type="auto">
  <name>Task 2: false-positive tuning pass (no policy widening)</name>
  <files>src/jobs/workspace.ts src/handlers/mention.test.ts</files>
  <action>
  Review guardrail checks for obvious false-positive edge cases and tighten detection behavior without reducing safety defaults.
  Add tests for any adjusted behavior.
  </action>
  <verify>
  - bun test
  </verify>
</task>

<task type="auto">
  <name>Task 3: operator quick-reference updates</name>
  <files>docs/runbooks/mentions.md</files>
  <action>
  Add a short troubleshooting section mapping common write failure reason codes to immediate operator actions.
  </action>
</task>

</tasks>

<verification>
- bun test
- bunx tsc --noEmit
</verification>

<output>
Create `.planning/phases/17-write-mode-reliability/17-02-SUMMARY.md`.
</output>
