---
phase: 75-live-ops-verification-closure
plan: 02
type: execute
wave: 2
depends_on: [75-01]
files_modified:
  - scripts/phase75-live-ops-verification-closure.ts
  - scripts/phase75-live-ops-verification-closure.test.ts
  - package.json
  - docs/smoke/phase75-live-ops-verification-closure.md
  - docs/runbooks/review-requested-debug.md
autonomous: true

must_haves:
  truths:
    - "Operators can run one deterministic live verification matrix that covers cache prime-hit-miss identities for both review_requested and explicit @kodiai mention surfaces"
    - "Verification output proves exactly one degraded telemetry event per degraded execution identity with duplicate detection checks"
    - "Verification output proves degraded executions still complete when telemetry persistence is intentionally failed"
    - "Final pass/fail verdict is machine-checkable and explicitly tied to check IDs and captured evidence"
  artifacts:
    - path: "scripts/phase75-live-ops-verification-closure.ts"
      provides: "Deterministic live OPS closure CLI with matrix validation, duplicate detection, fail-open completion checks, and check-ID verdicts"
      contains: "OPS75"
    - path: "scripts/phase75-live-ops-verification-closure.test.ts"
      provides: "Deterministic unit tests for matrix ordering, DB assertions, duplicate checks, completion checks, and verdict rendering"
      contains: "Final verdict"
    - path: "docs/smoke/phase75-live-ops-verification-closure.md"
      provides: "Exact live run sequence and evidence capture procedure for OPS-04/OPS-05 closure"
      contains: "verify:phase75"
  key_links:
    - from: "scripts/phase75-live-ops-verification-closure.ts"
      to: "rate_limit_events"
      via: "DB checks enforce exactly-once degraded telemetry identity and duplicate absence"
      pattern: "delivery_id|event_type|COUNT"
    - from: "scripts/phase75-live-ops-verification-closure.ts"
      to: "executions"
      via: "DB checks enforce degraded completion behavior under telemetry failure injection"
      pattern: "conclusion|degraded|telemetry"
    - from: "package.json"
      to: "scripts/phase75-live-ops-verification-closure.ts"
      via: "single deterministic command for live OPS closure verification"
      pattern: "verify:phase75"
    - from: "docs/runbooks/review-requested-debug.md"
      to: "scripts/phase75-live-ops-verification-closure.ts"
      via: "runbook SQL/debug guidance maps directly to script check IDs"
      pattern: "OPS75"
---

<objective>
Deliver the live-run verification harness and operator procedure that conclusively closes OPS-04 and OPS-05 with deterministic, evidence-cited pass/fail output.

Purpose: Phase 72 left OPS-04/OPS-05 requiring human/live proof; Phase 75 closes that gap with repeatable matrix execution and machine-checkable evidence criteria.
Output: New `verify:phase75` CLI, tests, and smoke/runbook instructions that prove cache hit/miss telemetry correctness, exactly-once degraded telemetry identity, and fail-open completion under telemetry write failure.
</objective>

<execution_context>
@/home/keith/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/keith/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/72-telemetry-follow-through/72-02-SUMMARY.md
@.planning/phases/72-telemetry-follow-through/72-VERIFICATION.md
@.planning/phases/74-reliability-regression-gate/74-02-SUMMARY.md
@.planning/phases/75-live-ops-verification-closure/75-01-SUMMARY.md
@scripts/phase72-telemetry-follow-through.ts
@docs/runbooks/review-requested-debug.md
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build deterministic Phase 75 live OPS closure CLI and assertion suite</name>
  <files>scripts/phase75-live-ops-verification-closure.ts, scripts/phase75-live-ops-verification-closure.test.ts</files>
  <action>
Create a dedicated closure script that verifies OPS-04 and OPS-05 from live-triggered evidence:

- Implement a fixed matrix covering both trigger surfaces (`review_requested`, explicit `@kodiai` mention) with deterministic prime -> hit -> changed-query miss identities.
- Require explicit identity inputs (delivery IDs / comment IDs / run IDs) and reject incomplete matrices so operators cannot improvise scenarios.
- Add DB assertions that cache telemetry outcomes match expected sequence for each matrix lane.
- Add DB assertions that degraded telemetry writes are exactly-once per execution identity (`delivery_id + event_type`) and report duplicates as hard failures.
- Add assertions that executions flagged for forced telemetry write failure still reach completed review output conclusions (fail-open completion proof).
- Emit machine-checkable check IDs (for example `OPS75-CACHE-*`, `OPS75-ONCE-*`, `OPS75-FAILOPEN-*`) and a deterministic final verdict line used by release evidence.
- Add pure helper tests for matrix validation, SQL/result evaluation, and verdict rendering so behavior is deterministic and unit-testable.
  </action>
  <verify>
Run `bun test scripts/phase75-live-ops-verification-closure.test.ts --timeout 30000`.
Run `bun scripts/phase75-live-ops-verification-closure.ts --help`.
Run `bunx tsc --noEmit`.
  </verify>
  <done>
Operators can run one deterministic script that returns PASS only when cache prime-hit-miss telemetry, exactly-once degraded emission identity, and fail-open completion-under-write-failure checks all succeed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire command and publish live evidence procedure for OPS closure</name>
  <files>package.json, docs/smoke/phase75-live-ops-verification-closure.md, docs/runbooks/review-requested-debug.md</files>
  <action>
Turn the closure harness into an operator-ready runbook path:

- Add `verify:phase75` script alias in `package.json` for deterministic invocation.
- Publish a dedicated smoke document with exact trigger order, identity capture requirements, command examples, expected check IDs, and explicit release-blocking interpretation.
- Update the review-requested debug runbook with SQL snippets and troubleshooting mapped to each OPS75 check family (cache sequence, duplicate telemetry, fail-open completion).
- Require evidence bundle capture (command output + check IDs + run identity table) in docs so OPS-04/OPS-05 closure is reproducible and auditable.
- Keep language evidence-bound: final verdict statements cite checks only; risk commentary belongs in analysis sections.
  </action>
  <verify>
Run `bun run verify:phase75 --help`.
Manually read `docs/smoke/phase75-live-ops-verification-closure.md` and confirm deterministic matrix + release-blocking rules are explicit.
  </verify>
  <done>
Phase 75 has a single documented command path that produces reproducible OPS closure evidence and blocks acceptance when any cache, exactly-once, or fail-open condition fails.
  </done>
</task>

</tasks>

<verification>
- `bun test scripts/phase75-live-ops-verification-closure.test.ts --timeout 30000` passes.
- `bun scripts/phase75-live-ops-verification-closure.ts --help` and `bun run verify:phase75 --help` succeed.
- `bunx tsc --noEmit` passes.
- Smoke/runbook docs map every closure claim to concrete check IDs and deterministic matrix inputs.
</verification>

<success_criteria>
OPS-04 and OPS-05 closure becomes executable and evidence-backed: operators run one deterministic matrix command across both trigger surfaces, prove cache hit/miss telemetry correctness, prove one degraded telemetry event per execution identity, and prove degraded executions complete when telemetry persistence fails.
</success_criteria>

<output>
After completion, create `.planning/phases/75-live-ops-verification-closure/75-02-SUMMARY.md`
</output>
