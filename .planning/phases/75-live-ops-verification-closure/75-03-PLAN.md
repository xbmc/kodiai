---
phase: 75-live-ops-verification-closure
plan: 03
type: execute
wave: 3
depends_on: [75-02]
files_modified:
  - src/knowledge/store.ts
  - src/knowledge/store.test.ts
  - scripts/phase75-live-ops-verification-closure.ts
  - docs/smoke/phase75-live-ops-verification-closure.md
  - docs/runbooks/review-requested-debug.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Deterministic closure evidence includes accepted review_requested and explicit @kodiai mention lanes for the same OPS75 matrix run"
    - "Live OPS75 evidence proves exactly one degraded telemetry row per degraded execution identity with duplicate checks passing"
    - "Live OPS75 evidence proves fail-open completion under forced telemetry write failure without unrelated author-cache write faults"
  artifacts:
    - path: "src/knowledge/store.ts"
      provides: "Author-cache persistence path no longer emits `author_cache.repo` NOT NULL runtime write failures during OPS capture"
      contains: "author_cache"
    - path: "scripts/phase75-live-ops-verification-closure.ts"
      provides: "Verifier preflight/checks reject incomplete lane evidence and enforce degraded + fail-open identity proof inputs"
      contains: "OPS75"
    - path: "docs/smoke/phase75-live-ops-verification-closure.md"
      provides: "Operator procedure explicitly requires accepted review_requested gate evidence before identity capture and blocks closure on missing degraded/fail-open proof"
      contains: "review_requested"
  key_links:
    - from: "src/knowledge/store.ts"
      to: "src/handlers/review.ts"
      via: "Author-tier cache writes stay non-fatal and do not contaminate fail-open telemetry verification runs"
      pattern: "author_cache|warning|repo"
    - from: "docs/smoke/phase75-live-ops-verification-closure.md"
      to: "scripts/phase75-live-ops-verification-closure.ts"
      via: "Identity capture contract and verifier CLI arguments stay aligned for lane, degraded, and fail-open checks"
      pattern: "verify:phase75|OPS75"
    - from: "docs/runbooks/review-requested-debug.md"
      to: "src/handlers/review.ts"
      via: "Preflight confirms review_requested gate acceptance is `kodiai`/team before matrix evidence is considered valid"
      pattern: "review_requested|requestedReviewer|skipReason"
---

<objective>
Close the remaining Phase 75 verification blockers by hardening live evidence prerequisites, removing runtime author-cache noise from OPS capture runs, and collecting passing OPS75 closure artifacts.

Purpose: Verification is blocked by missing accepted review_requested lane evidence, absent degraded telemetry rows, and missing fail-open proof under forced telemetry write failure.
Output: A remediation plan that fixes author-cache live-write instability, tightens OPS75 preflight/evidence contracts, and captures a passing closure run tied to OPS75 check IDs.
</objective>

<execution_context>
@/home/keith/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/keith/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/75-live-ops-verification-closure/75-01-SUMMARY.md
@.planning/phases/75-live-ops-verification-closure/75-02-SUMMARY.md
@.planning/phases/75-live-ops-verification-closure/75-VERIFICATION.md
@src/knowledge/store.ts
@src/handlers/review.ts
@scripts/phase75-live-ops-verification-closure.ts
@docs/smoke/phase75-live-ops-verification-closure.md
@docs/runbooks/review-requested-debug.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix or isolate live author-cache persistence faults that invalidate OPS75 fail-open evidence runs</name>
  <files>src/knowledge/store.ts, src/knowledge/store.test.ts</files>
  <action>
Address the live `author_cache.repo` NOT NULL failure path so OPS75 evidence collection is not polluted by unrelated storage faults:

- Trace all author-cache write paths and guarantee required repo identity fields are populated before insert/update operations.
- If repo identity is unavailable in a valid runtime branch, degrade that write path safely (skip write with structured warning) without throwing into review execution.
- Add regression tests that reproduce the previously failing shape and assert no NOT NULL write failure escapes while author-tier logic remains functional.
- Keep telemetry fail-open behavior unchanged; this task removes runtime noise, not OPS75 criteria.
  </action>
  <verify>
Run `bun test src/knowledge/store.test.ts --timeout 30000`.
Run `bunx tsc --noEmit`.
  </verify>
  <done>
Live verification runs no longer emit `author_cache.repo` NOT NULL failures, and author-cache persistence behavior remains deterministic and non-fatal.
  </done>
</task>

<task type="auto">
  <name>Task 2: Enforce OPS75 preflight and evidence contracts for accepted review lane plus degraded/fail-open identities</name>
  <files>scripts/phase75-live-ops-verification-closure.ts, docs/smoke/phase75-live-ops-verification-closure.md, docs/runbooks/review-requested-debug.md</files>
  <action>
Close documentation and verifier contract gaps called out by verification:

- Add an explicit preflight requirement (and matching verifier validation where possible) that review_requested identities are accepted by kodiai reviewer/team policy before matrix evidence is accepted.
- Require degraded identity inputs that actually produced `degradation_path != none` telemetry rows; fail with actionable check IDs when only `degradation_path=none` rows exist.
- Keep OPS75 duplicate and fail-open checks tied to the exact same identity set and surface clear blocking output for missing or mismatched evidence.
- Update smoke and debug runbooks so operators can reliably capture accepted gate logs, degraded identity rows, and forced-failure identity outputs in one bundle.
  </action>
  <verify>
Run `bun test ./scripts/phase75-live-ops-verification-closure.test.ts --timeout 30000`.
Run `bun run verify:phase75 --help`.
Manually read `docs/smoke/phase75-live-ops-verification-closure.md` to confirm preflight and release-blocking rules are explicit.
  </verify>
  <done>
The documented and scripted OPS75 path rejects incomplete/invalid lane evidence and gives deterministic check-ID failures for missing degraded or fail-open proof.
  </done>
</task>

<task type="auto">
  <name>Task 3: Re-run live OPS75 matrix and capture passing closure evidence for all blocked truths</name>
  <files>scripts/phase75-live-ops-verification-closure.ts, docs/smoke/phase75-live-ops-verification-closure.md</files>
  <action>
Execute a fresh live verification run after Tasks 1-2 and record closure evidence:

- Capture new review_requested identities where gate acceptance is explicit (`requestedReviewer=kodiai|kodiai[bot]|approved team`) and pair them with mention lane identities.
- Trigger degraded runs that actually enter rate-limit degradation, then verify exactly one degraded row per identity and duplicate query pass (`OPS75-ONCE-*`).
- Run forced telemetry write-failure identities via `TELEMETRY_RATE_LIMIT_FAILURE_IDENTITIES` and verify passing `OPS75-FAILOPEN-01/02` with non-failing completion evidence.
- Record verifier output and identity table in the phase summary; if any OPS75 checks fail, stop and document blockers rather than claiming closure.
  </action>
  <verify>
Run `bun run verify:phase75` with fresh lane/degraded/fail-open identity arguments from the live run.
Confirm final verdict is PASS and includes passing `OPS75-CACHE-*`, `OPS75-ONCE-*`, and `OPS75-FAILOPEN-*` families.
  </verify>
  <done>
Phase 75 has a fresh live evidence bundle proving both surfaces, exactly-once degraded telemetry, and fail-open completion under forced telemetry persistence failure.
  </done>
</task>

</tasks>

<verification>
- `bun test src/knowledge/store.test.ts --timeout 30000` passes.
- `bun test ./scripts/phase75-live-ops-verification-closure.test.ts --timeout 30000` passes.
- `bun run verify:phase75 --help` succeeds with updated preflight/evidence contract guidance.
- A fresh live `bun run verify:phase75 ...` run returns PASS for cache, exactly-once, and fail-open check families.
- Summary includes accepted review_requested gate evidence plus degraded/fail-open identity outputs tied to OPS75 check IDs.
</verification>

<success_criteria>
All three failed truths in `75-VERIFICATION.md` are closed with reproducible live evidence: accepted review_requested lane coverage exists, degraded telemetry exactly-once proof is present, and forced telemetry-failure fail-open completion passes without unrelated author-cache write failures.
</success_criteria>

<output>
After completion, create `.planning/phases/75-live-ops-verification-closure/75-03-SUMMARY.md`
</output>
