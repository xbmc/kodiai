---
phase: 76-success-path-status-contract-parity
plan: 02
type: execute
wave: 2
depends_on: [76-01]
files_modified:
  - scripts/phase74-reliability-regression-gate.ts
  - scripts/phase74-reliability-regression-gate.test.ts
  - docs/smoke/phase74-reliability-regression-gate.md
  - docs/runbooks/xbmc-ops.md
autonomous: true

must_haves:
  truths:
    - "Regression gate validates both issue write failure and success status envelopes as machine-checkable contract paths"
    - "Runbook and smoke procedures define one shared status-envelope shape for success and failure evidence capture"
    - "Automated tests fail when success-path status fields regress or become non-machine-checkable"
  artifacts:
    - path: "scripts/phase74-reliability-regression-gate.ts"
      provides: "Status-envelope parser and REL checks covering both success and failure paths"
      contains: "status: success"
    - path: "scripts/phase74-reliability-regression-gate.test.ts"
      provides: "Deterministic regression coverage for success/failure status envelope parity"
      contains: "REL-74"
    - path: "docs/smoke/phase74-reliability-regression-gate.md"
      provides: "Operator scenario format and release-blocking interpretation for dual-path status contract checks"
      contains: "status: success"
  key_links:
    - from: "scripts/phase74-reliability-regression-gate.ts"
      to: "src/handlers/mention.ts"
      via: "Gate parser consumes producer status markers from both success and failure replies"
      pattern: "status: success|status: pr_creation_failed|failed_step:|pr_url:|issue_linkback_url:"
    - from: "scripts/phase74-reliability-regression-gate.test.ts"
      to: "scripts/phase74-reliability-regression-gate.ts"
      via: "Unit checks assert gate fails when success-path markers are absent or malformed"
      pattern: "parseIssueWriteStatus|evaluateScenarioChecks"
    - from: "docs/runbooks/xbmc-ops.md"
      to: "docs/smoke/phase74-reliability-regression-gate.md"
      via: "Operator evidence capture requirements use the same dual-path status-envelope fields"
      pattern: "status:|failed_step:|pr_url:|issue_linkback_url:"
---

<objective>
Enforce success/failure status-path contract parity in the regression gate and operator procedures so consumer validation matches producer output.

Purpose: Producer-side success markers are only useful if the regression gate and runbook treat success and failure as the same machine-checkable contract family.
Output: Updated Phase 74 gate parser/checks, deterministic tests, and smoke/runbook guidance that validate dual-path status envelopes.
</objective>

<execution_context>
@/home/keith/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/keith/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/74-reliability-regression-gate/74-02-SUMMARY.md
@.planning/phases/76-success-path-status-contract-parity/76-01-SUMMARY.md
@scripts/phase74-reliability-regression-gate.ts
@scripts/phase74-reliability-regression-gate.test.ts
@docs/smoke/phase74-reliability-regression-gate.md
@docs/runbooks/xbmc-ops.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend Phase 74 gate parser and REL checks for dual-path status-envelope parity</name>
  <files>scripts/phase74-reliability-regression-gate.ts</files>
  <action>
Upgrade gate logic so success and failure paths are validated as one contract family:

- Update status parsing to read machine-checkable success markers (`status: success`, `pr_url`, `issue_linkback_url`) in addition to failure markers (`status: pr_creation_failed`, `failed_step`, `diagnostics`).
- Enforce REL checks that treat both status paths as contract obligations: failure path requires `failed_step` diagnostics; success path requires deterministic URL markers plus artifact-triad consistency.
- Keep deterministic check-ID output style and non-zero fail-closed behavior; do not weaken existing CAP/RET checks.
- Preserve backwards compatibility only as transitional parsing support (if retained) but make missing machine-checkable success markers a failing REL result.
  </action>
  <verify>
Run `bun test ./scripts/phase74-reliability-regression-gate.test.ts --timeout 30000`.
Run `bun run verify:phase74 --help`.
  </verify>
  <done>
Phase 74 gate fails whenever either success-path or failure-path status envelopes are non-machine-checkable or contract-incomplete.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add deterministic gate tests for success-path status semantics regression</name>
  <files>scripts/phase74-reliability-regression-gate.test.ts</files>
  <action>
Expand script tests to prove contract parity is enforced:

- Add passing fixture coverage for `status: success` envelope with deterministic `pr_url` and `issue_linkback_url` markers.
- Add failing coverage where success reply omits one or more required markers, asserting REL checks fail with actionable IDs.
- Keep existing failure-path assertions (`pr_creation_failed`, `failed_step`) and combined retrieval assertions to ensure no regression in prior contract scope.
- Verify summary/final verdict output still reports failed check IDs deterministically.
  </action>
  <verify>
Run `bun test ./scripts/phase74-reliability-regression-gate.test.ts --timeout 30000`.
  </verify>
  <done>
Automated gate tests now fail on success-path status contract drift the same way they already fail for failure-path drift.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update smoke and runbook procedures to capture shared success/failure status envelopes</name>
  <files>docs/smoke/phase74-reliability-regression-gate.md, docs/runbooks/xbmc-ops.md</files>
  <action>
Bring operator documentation into parity with the updated contract:

- Update smoke scenario examples and evidence checklist to include machine-checkable success markers (`status: success`, `pr_url`, `issue_linkback_url`) alongside existing failure markers.
- Update runbook troubleshooting so REL failure guidance explicitly covers both missing failure fields and missing success fields under the same status-envelope contract.
- Keep release-blocking interpretation tied to failed `REL-74-*` IDs without introducing ambiguous prose-only pass criteria.
  </action>
  <verify>
Manually read `docs/smoke/phase74-reliability-regression-gate.md` and `docs/runbooks/xbmc-ops.md` and confirm both document the same dual-path status-envelope fields.
  </verify>
  <done>
Operator procedures and regression gate checks now enforce one shared machine-checkable status contract for issue write success and failure paths.
  </done>
</task>

</tasks>

<verification>
- `bun test ./scripts/phase74-reliability-regression-gate.test.ts --timeout 30000` passes with new success-envelope regressions.
- `bun run verify:phase74 --help` succeeds and still documents deterministic non-zero blocking behavior.
- Smoke and runbook docs describe the same dual-path status-envelope contract fields.
- `bunx tsc --noEmit` passes.
</verification>

<success_criteria>
Consumer parity is enforced: regression gate logic, tests, and operator procedures all validate success and failure status envelopes using the same machine-checkable contract shape.
</success_criteria>

<output>
After completion, create `.planning/phases/76-success-path-status-contract-parity/76-02-SUMMARY.md`
</output>
