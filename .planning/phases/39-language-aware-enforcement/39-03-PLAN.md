---
phase: 39-language-aware-enforcement
plan: 03
type: tdd
wave: 2
depends_on: ["39-01"]
files_modified:
  - src/enforcement/tooling-suppression.ts
  - src/enforcement/tooling-suppression.test.ts
autonomous: true

must_haves:
  truths:
    - "When a formatter config exists for a language, formatting/style findings in that language are suppressed"
    - "When a linter config exists for a language, import-ordering findings in that language are suppressed"
    - "Only formatting and import-order findings are suppressed -- correctness findings are never suppressed by tooling detection"
    - "User toolingOverrides from .kodiai.yml can disable suppression per language or per type"
    - "Unknown languages pass through without errors"
    - "Suppressed findings are marked with toolingSuppressed=true"
  artifacts:
    - path: "src/enforcement/tooling-suppression.ts"
      provides: "suppressToolingFindings function and finding category keyword sets"
      exports: ["suppressToolingFindings", "FORMATTING_KEYWORDS", "IMPORT_ORDER_KEYWORDS"]
    - path: "src/enforcement/tooling-suppression.test.ts"
      provides: "Comprehensive tests for tooling-based finding suppression"
  key_links:
    - from: "src/enforcement/tooling-suppression.ts"
      to: "src/enforcement/types.ts"
      via: "imports DetectedTooling, LanguageRulesConfig"
      pattern: "import.*DetectedTooling.*from.*types"
    - from: "src/enforcement/tooling-suppression.ts"
      to: "src/execution/diff-analysis.ts"
      via: "imports classifyFileLanguage for per-file language detection"
      pattern: "import.*classifyFileLanguage.*from.*diff-analysis"
---

<objective>
Implement tooling-aware finding suppression that eliminates auto-fixable noise when repos have formatter/linter configs.

Purpose: When a repo has `.prettierrc`, `.clang-format`, `.eslintrc`, etc., the bot should produce zero findings about formatting style or import ordering in those languages -- the tooling handles it. This eliminates the most common source of low-value review noise.

Output: `src/enforcement/tooling-suppression.ts` with `suppressToolingFindings()` pure function, fully tested via TDD.
</objective>

<execution_context>
@/home/keith/.claude/get-shit-done/workflows/execute-plan.md
@/home/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/39-language-aware-enforcement/39-CONTEXT.md
@.planning/phases/39-language-aware-enforcement/39-RESEARCH.md
@.planning/phases/39-language-aware-enforcement/39-01-SUMMARY.md
@src/enforcement/types.ts
@src/enforcement/tooling-detection.ts
@src/knowledge/types.ts
@src/execution/diff-analysis.ts
</context>

<feature>
  <name>Tooling-Aware Finding Suppression</name>
  <files>src/enforcement/tooling-suppression.ts, src/enforcement/tooling-suppression.test.ts</files>
  <behavior>
Pure function: `suppressToolingFindings(params) -> findings with toolingSuppressed flag`

Params:
- `findings`: Array of finding objects with `{ filePath, title, severity, category, ... }`
- `detectedTooling`: DetectedTooling from tooling-detection.ts
- `languageRules?`: Optional LanguageRulesConfig for user overrides

Behavior cases:

1. **Formatting finding in TypeScript file when .prettierrc exists**
   Tooling: formatters has TypeScript -> [".prettierrc"]
   Finding: `{ filePath: "src/app.ts", title: "Inconsistent indentation style", severity: "minor", category: "style" }`
   Expected: `{ ...finding, toolingSuppressed: true }`

2. **Import ordering finding in TypeScript file when eslint config exists**
   Tooling: linters has TypeScript -> [".eslintrc.json"]
   Finding: `{ filePath: "src/app.ts", title: "Import statements should be sorted alphabetically", severity: "minor", category: "style" }`
   Expected: `{ ...finding, toolingSuppressed: true }`

3. **Correctness finding in TypeScript file when prettier exists (NOT suppressed)**
   Tooling: formatters has TypeScript -> [".prettierrc"]
   Finding: `{ filePath: "src/app.ts", title: "Possible null reference error", severity: "major", category: "correctness" }`
   Expected: `{ ...finding, toolingSuppressed: false }`

4. **Formatting finding in Python file when .black.toml exists**
   Tooling: formatters has Python -> [".black.toml"]
   Finding: `{ filePath: "utils/parser.py", title: "Line exceeds maximum length", severity: "minor", category: "style" }`
   Expected: `{ ...finding, toolingSuppressed: true }`

5. **Formatting finding in C++ file when .clang-format exists**
   Tooling: formatters has C++ -> [".clang-format"]
   Finding: `{ filePath: "src/parser.cpp", title: "Bracket placement inconsistency", severity: "minor", category: "style" }`
   Expected: `{ ...finding, toolingSuppressed: true }`

6. **Go formatting finding (always suppressed -- gofmt is built-in)**
   Tooling: formatters has Go -> ["go.mod (gofmt built-in)"]
   Finding: `{ filePath: "handlers/auth.go", title: "Formatting does not match gofmt standard", severity: "minor", category: "style" }`
   Expected: `{ ...finding, toolingSuppressed: true }`

7. **No formatter detected for language -- finding passes through**
   Tooling: formatters empty for Rust
   Finding: `{ filePath: "src/lib.rs", title: "Inconsistent indentation", severity: "minor", category: "style" }`
   Expected: `{ ...finding, toolingSuppressed: false }`

8. **User override: suppressFormatting=false disables formatting suppression**
   Tooling: formatters has TypeScript -> [".prettierrc"]
   languageRules.toolingOverrides: [{ language: "TypeScript", suppressFormatting: false, suppressImportOrder: true }]
   Finding: `{ filePath: "src/app.ts", title: "Inconsistent indentation style", severity: "minor", category: "style" }`
   Expected: `{ ...finding, toolingSuppressed: false }` (user disabled formatting suppression)

9. **User override: suppressImportOrder=false keeps import findings**
   Tooling: linters has TypeScript -> [".eslintrc.json"]
   languageRules.toolingOverrides: [{ language: "TypeScript", suppressFormatting: true, suppressImportOrder: false }]
   Finding: `{ filePath: "src/app.ts", title: "Import order is wrong", severity: "minor", category: "style" }`
   Expected: `{ ...finding, toolingSuppressed: false }` (user kept import order findings)

10. **Unknown language finding passes through without error**
    Tooling: empty maps
    Finding: `{ filePath: "src/main.zig", title: "Style issue", severity: "minor", category: "style" }`
    Expected: `{ ...finding, toolingSuppressed: false }` (no crash, no suppression)

Keyword sets for identifying finding types:

FORMATTING_KEYWORDS (finding title matches any of these -> formatting finding):
- `["formatting"]`, `["indentation"]`, `["indent"]`, `["trailing", "comma"]`, `["semicolon"]`,
  `["bracket", "placement"]`, `["brace", "style"]`, `["line", "length"]`, `["whitespace"]`,
  `["spacing"]`, `["quote", "style"]`, `["tab"]`, `["newline"]`

IMPORT_ORDER_KEYWORDS (finding title matches any of these -> import-order finding):
- `["import", "order"]`, `["import", "sort"]`, `["import", "group"]`, `["import", "arrange"]`,
  `["sorted", "import"]`, `["organize", "import"]`
  </behavior>
  <implementation>
1. Export `FORMATTING_KEYWORDS: string[][]` and `IMPORT_ORDER_KEYWORDS: string[][]` as the keyword sets above.

2. Export helper `isFormattingFinding(title: string): boolean` -- checks normalized title against FORMATTING_KEYWORDS using same OR-of-AND logic as severity-floors matchesPattern.

3. Export helper `isImportOrderFinding(title: string): boolean` -- same with IMPORT_ORDER_KEYWORDS.

4. Export `suppressToolingFindings(params): findings[]`:
   - For each finding:
     a. Detect language via `classifyFileLanguage(finding.filePath)` from diff-analysis.ts
     b. Check if user has a toolingOverride for this language
     c. If formatting finding AND (formatter detected for language OR user override says suppress) AND user override does not say `suppressFormatting: false` -> set `toolingSuppressed: true`
     d. If import-order finding AND (linter detected for language OR user override says suppress) AND user override does not say `suppressImportOrder: false` -> set `toolingSuppressed: true`
     e. Otherwise: `toolingSuppressed: false`
   - Also only match on category "style" or "documentation" findings for formatting suppression -- never suppress "correctness", "security", or "performance" findings via tooling detection (per research pitfall 6)
  </implementation>
</feature>

<verification>
1. `bun test src/enforcement/tooling-suppression.test.ts` -- all tests pass
2. RED phase: tests written first, must fail before implementation
3. GREEN phase: minimal implementation makes all tests pass
4. Only formatting and import-order findings are suppressed, never correctness/security/performance
5. User toolingOverrides are respected
</verification>

<success_criteria>
- Formatting findings suppressed when formatter config exists for the file's language
- Import-order findings suppressed when linter config exists for the file's language
- Correctness, security, and performance findings never suppressed by tooling detection
- User toolingOverrides can enable or disable suppression per language and per type
- Unknown languages pass through without errors
- Pure function with no side effects, fully testable
</success_criteria>

<output>
After completion, create `.planning/phases/39-language-aware-enforcement/39-03-SUMMARY.md`
</output>
