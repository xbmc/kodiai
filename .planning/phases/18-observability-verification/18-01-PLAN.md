---
phase: 18-observability-verification
plan: 01
type: execute
wave: 1
depends_on:
  - 17-write-mode-reliability/17-01-SUMMARY.md
files_modified:
  - src/handlers/mention.ts
  - src/handlers/review.ts
  - docs/runbooks/mentions.md
  - docs/runbooks/review-requested-debug.md
autonomous: true

must_haves:
  truths:
    - "Every publishable outcome logs an evidence bundle (deliveryId + URLs)"
    - "Evidence bundle is easy to grep and copy/paste"
    - "Runbooks point to the exact evidence keys"
---

<objective>
Improve observability and verification UX by standardizing a single evidence bundle log line for each execution and publish.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Add evidence bundle logging for mention write-mode outcomes</name>
  <files>src/handlers/mention.ts</files>
  <action>
  When write-mode creates or reuses a PR, log one structured line containing:
  - deliveryId
  - installationId
  - owner/repo
  - source prNumber
  - triggering commentId + URL
  - writeOutputKey
  - branchName
  - created/reused PR URL
  </action>
</task>

<task type="auto">
  <name>Task 2: Add evidence bundle logging for review outputs</name>
  <files>src/handlers/review.ts</files>
  <action>
  When a review run publishes output (summary comment or inline comments) or submits an approval, emit a standardized evidence bundle log line.
  </action>
</task>

<task type="auto">
  <name>Task 3: Update runbooks to reference evidence bundle fields</name>
  <files>docs/runbooks/mentions.md docs/runbooks/review-requested-debug.md</files>
  <action>
  Add a short section describing the evidence bundle keys and how to search for them by deliveryId.
  </action>
</task>

</tasks>

<verification>
- bun test
</verification>

<output>
Create `.planning/phases/18-ops-evidence/18-01-SUMMARY.md`.
</output>
