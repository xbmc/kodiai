---
phase: 56-foundation-layer
plan: 03
type: execute
wave: 2
depends_on: ["56-02"]
files_modified:
  - src/lib/pr-intent-parser.ts
  - src/execution/review-prompt.ts
  - src/execution/review-prompt.test.ts
  - src/handlers/review.ts
autonomous: true

must_haves:
  truths:
    - "When PR titles contain unrecognized bracket tags (e.g. [Auth], [iOS]), the review prompt includes them as focus hints"
    - "Review Details keyword parsing no longer labels unrecognized tags as 'ignored'"
    - "No behavior changes occur when there are no unrecognized bracket tags"
  artifacts:
    - path: "src/lib/pr-intent-parser.ts"
      provides: "Keyword parsing section renders unrecognized tags as focus hints"
      contains: "focus hints"
    - path: "src/execution/review-prompt.ts"
      provides: "buildReviewPrompt supports focusHints and renders a Focus Hints prompt section"
      contains: "Focus Hints"
    - path: "src/handlers/review.ts"
      provides: "Passes parsedIntent.unrecognized into buildReviewPrompt focusHints"
      contains: "focusHints"
  key_links:
    - from: "src/handlers/review.ts"
      to: "src/execution/review-prompt.ts"
      via: "buildReviewPrompt({ focusHints: ... })"
      pattern: "buildReviewPrompt\(\{[\s\S]*focusHints"
---

<objective>
Surface unrecognized bracket tags as component/platform focus hints in the review prompt and Review Details output (INTENT-01).

Purpose: Unrecognized bracket tags should guide attention ("focus hints") rather than being labeled as "ignored", improving intent UX without changing core behavior.
Output: Prompt builder accepts focus hints, handler threads them through, and Review Details keyword parsing renders them as focus hints.
</objective>

<execution_context>
@/home/keith/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/keith/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/56-foundation-layer/56-RESEARCH.md
@src/lib/pr-intent-parser.ts
@src/execution/review-prompt.ts
@src/handlers/review.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Render unrecognized bracket tags as focus hints (not "ignored")</name>
  <files>src/lib/pr-intent-parser.ts</files>
  <action>
Update the keyword parsing UX so unrecognized tags are treated as focus hints.

- In `src/lib/pr-intent-parser.ts`, update `buildKeywordParsingSection(intent)`:
  - Keep recognized tag rendering unchanged.
  - Replace the existing line that renders unrecognized tags as `ignored [...]` with a focus-hint rendering, e.g.:
    - `  - focus hints: [AUTH], [IOS]` (uppercase tags inside brackets)
  - Preserve the rest of the section behavior:
    - When no signals exist, still return `- Keyword parsing: No keywords detected`.
    - Conventional type and breaking change signals remain unchanged.

Do not change the parsing logic (only the formatting/output UX).
  </action>
  <verify>bun test src/execution/review-prompt.test.ts</verify>
  <done>
Keyword parsing output never uses the word "ignored" for unrecognized bracket tags.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Focus Hints section to buildReviewPrompt and thread through handler</name>
  <files>src/execution/review-prompt.ts, src/execution/review-prompt.test.ts, src/handlers/review.ts</files>
  <action>
Add a first-class "Focus Hints" prompt section and pass it from parsed intent.

- In `src/execution/review-prompt.ts`:
  - Extend `buildReviewPrompt(context)` signature with `focusHints?: string[]`.
  - If `focusHints` is provided and non-empty, insert a new section near the top (after PR intent scoping is fine):
    - Header: `## Focus Hints`
    - Body:
      - Render each hint as `- [HINT]` (uppercase) to match bracket tag vocabulary.
      - Include 1-2 instruction lines explaining they are hints, not requirements (avoid prompting hallucinations).
        Example guidance:
        - "These tags came from the PR title/commits; treat them as components/platforms to pay extra attention to when reviewing."
        - "Do not invent context if the diff does not touch the hinted areas."

- In `src/handlers/review.ts`:
  - When calling `buildReviewPrompt(...)`, pass `focusHints: parsedIntent.unrecognized`.
  - Ensure only unrecognized tags become focus hints; recognized control tags remain control-plane only.

- In `src/execution/review-prompt.test.ts`:
  - Add a test that provides `focusHints: ["auth", "ios"]` and asserts the generated prompt contains the "## Focus Hints" section and both hints rendered as `[AUTH]` and `[IOS]`.
  - Add a test ensuring when `focusHints` is empty/undefined, the prompt does NOT include the Focus Hints section.

Keep this change purely prompt/formatting: no webhook trigger changes and no new GitHub publication behavior.
  </action>
  <verify>bun test src/execution/review-prompt.test.ts && grep -n "focusHints: parsedIntent\.unrecognized" src/handlers/review.ts</verify>
  <done>
Unrecognized bracket tags are visible in the review prompt as focus hints and Review Details no longer labels them as ignored.
  </done>
</task>

</tasks>

<verification>
- `bun test` passes
- Manual spot-check: PR titled `[Auth] Bump foo from 1.0.0 to 1.1.0` yields a prompt containing a Focus Hints section with `[AUTH]`
</verification>

<success_criteria>
- INTENT-01 satisfied: unrecognized bracket tags are surfaced as focus hints in both prompt and deterministic Review Details.
</success_criteria>

<output>
After completion, create `.planning/phases/56-foundation-layer/56-03-SUMMARY.md`
</output>
