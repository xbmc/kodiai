---
phase: 83-slack-response-conciseness
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/slack/assistant-handler.ts
  - src/slack/assistant-handler.test.ts
autonomous: true
requirements:
  - SLK-07
  - SLK-08
  - SLK-09
  - SLK-10

must_haves:
  truths:
    - "Slack system prompt enforces answer-first opening with no preamble phrases"
    - "Slack system prompt bans Sources/References trailing sections"
    - "Slack system prompt calibrates length: 1 sentence for simple, ~5 sentences for complex, with truncate-and-offer pattern"
    - "Slack system prompt enforces casual conversational tone with no headers for simple answers"
    - "Slack system prompt bans all AI-isms and filler phrases"
  artifacts:
    - path: "src/slack/assistant-handler.ts"
      provides: "Rewritten buildSlackAssistantPrompt with full conciseness instructions"
      contains: "Never open with preamble"
    - path: "src/slack/assistant-handler.test.ts"
      provides: "Tests asserting prompt includes conciseness, banned phrases, length calibration, and tone rules"
      contains: "Never open with preamble"
  key_links:
    - from: "src/slack/assistant-handler.ts"
      to: "executor.execute"
      via: "prompt parameter passed to execute()"
      pattern: "prompt.*buildSlackAssistantPrompt"
---

<objective>
Rewrite the Slack assistant system prompt so responses read like chat messages from a senior engineer teammate: answer-first, concise, no AI-isms, no trailing sections, casual tone.

Purpose: Slack users currently get documentation-style responses with preambles, headers, and Sources sections. This makes Kodiai feel robotic rather than like a knowledgeable colleague.
Output: Updated `buildSlackAssistantPrompt` function and corresponding test assertions.
</objective>

<execution_context>
@/home/keith/.claude/get-shit-done/workflows/execute-plan.md
@/home/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/83-slack-response-conciseness/83-CONTEXT.md
@src/slack/assistant-handler.ts
@src/slack/assistant-handler.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite buildSlackAssistantPrompt with full conciseness instructions</name>
  <files>src/slack/assistant-handler.ts</files>
  <action>
Replace the `buildSlackAssistantPrompt` function (lines 86-119) with a rewritten version that encodes all locked decisions from 83-CONTEXT.md. Keep the function signature and return type identical (accepts `{ repoContext, messageText, writeMode }`, returns `string`). Keep the `modeInstructions` block (read-only vs write-capable) unchanged.

Replace the current "Slack response style:" section with comprehensive instructions covering:

**Response opening (SLK-07):**
- Jump straight to the answer. No greeting, preamble, or lead-in.
- Never open with phrases like "Here's what I found", "Based on the codebase", "Great question!", "Certainly!", "Let me explain", "Happy to help!"
- No closing or sign-off. End when the answer is done. Never "Let me know if..." or "Hope that helps!"

**Trailing sections (SLK-08):**
- Never append Sources, References, Related Files, Next Steps, or any trailing section.

**Length calibration (SLK-09):**
- Simple factual questions: 1 sentence max.
- Explain/how-does-X-work questions: ~5 sentences / short paragraph, even for complex topics.
- If a response would exceed ~5 sentences, truncate to a concise version and offer "want the full breakdown?" — only expand if asked.
- Only volunteer unsolicited info for critical gotchas or footguns.

**Tone and formatting (SLK-10):**
- Casual tone, like a friend who knows the codebase. Contractions OK, informal phrasing OK.
- Avoid first person — "that file doesn't exist" not "I don't see that file."
- Never hedge — state things definitively or say "not sure." No "I think..." or "it looks like..."
- Simple questions: plain text with inline backticks for file paths/function names. No headers, no bullet lists.
- Complex questions: bullets OK for lists, but never section headers (##). Keep it flat.
- Code snippets: inline backticks for names, triple-backtick blocks OK for 1-5 line snippets.
- Emoji sparingly for warnings (e.g. warning emoji) but not decorative.

Keep the final section that appends "Slack message:" and the message text.
  </action>
  <verify>
Run `bun test src/slack/assistant-handler.test.ts` — some existing prompt assertions will fail because the prompt text changed. That is expected and will be fixed in Task 2.
  </verify>
  <done>
`buildSlackAssistantPrompt` returns a prompt string containing all conciseness rules: no preamble, no trailing sections, length calibration, casual tone, banned phrases. The read-only/write-capable mode sections are preserved unchanged.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update tests to assert new prompt conciseness rules</name>
  <files>src/slack/assistant-handler.test.ts</files>
  <action>
Update the existing test "routes to default xbmc/xbmc and enforces read-only executor contract" to replace the old prompt assertions with new ones that verify the rewritten prompt includes key conciseness rules. Specifically:

Replace the assertion `expect(executionInputs[0]?.prompt).toContain("Lead with the direct answer in the first sentence.");` with assertions for the new prompt content. At minimum assert:

1. Prompt contains a "never open with preamble" rule (verifies SLK-07)
2. Prompt contains a "never append Sources" or "trailing section" rule (verifies SLK-08)
3. Prompt contains a length calibration rule like "1 sentence" for simple questions (verifies SLK-09)
4. Prompt contains a casual tone rule (verifies SLK-10)
5. Prompt still contains "Repository context: xbmc/xbmc" (existing assertion, keep)
6. Prompt still contains read-only execution requirements (existing assertions, keep)

Also update the test "routes explicit apply: prefix to write-capable executor path" — keep its assertion that the prompt contains "Write-capable execution requirements:" and does NOT contain "Read-only execution requirements:". No new assertions needed there.

Keep all other tests unchanged — they do not assert on prompt content.
  </action>
  <verify>
Run `bun test src/slack/assistant-handler.test.ts` — all tests pass.
  </verify>
  <done>
All tests in `assistant-handler.test.ts` pass. Tests verify the prompt encodes no-preamble, no-trailing-sections, length calibration, and casual tone rules.
  </done>
</task>

</tasks>

<verification>
1. `bun test src/slack/assistant-handler.test.ts` — all tests pass
2. `bun test` — full suite passes (no regressions)
3. Manual inspection: `buildSlackAssistantPrompt` includes all locked decisions from 83-CONTEXT.md
4. The prompt does NOT contain any of the banned phrases: "Here's what I found", "Based on the codebase", "Certainly!", "Happy to help!", "Great question!", "Let me explain"
</verification>

<success_criteria>
- buildSlackAssistantPrompt encodes all conciseness rules from phase context decisions
- All existing tests pass with updated assertions
- No changes to executor, routing, or any file other than assistant-handler.ts and its test
- Prompt still correctly includes read-only vs write-capable mode instructions
</success_criteria>

<output>
After completion, create `.planning/phases/83-slack-response-conciseness/83-01-SUMMARY.md`
</output>
