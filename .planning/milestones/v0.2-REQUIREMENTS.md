# Requirements: v0.2 (Mention-Driven Changes)

**Status:** DRAFT
**Defined:** 2026-02-10

This milestone defines the next set of requirements after v0.1 shipped. v0.2 focuses on enabling safe, auditable, mention-driven code changes while improving durability and operator evidence.

## Goal

Allow maintainers to ask Kodiai to make small, controlled changes via `@kodiai` / `@claude` mentions, with guardrails that prevent unsafe writes and make every action traceable.

## v0.2 Requirements

### Mention-Driven Code Modification

- [ ] **MOD-01**: Mention can request a change and Kodiai proposes an explicit plan (files to touch + intended outcome) before writing.
- [ ] **MOD-02**: Kodiai can create a branch in the target repo (or fork-safe alternative) with a deterministic branch name.
- [ ] **MOD-03**: Kodiai can commit changes with a clear message that includes a short rationale and trace links.
- [ ] **MOD-04**: Kodiai can push the branch and open/update a PR (or update the existing PR when invoked from a PR context).
- [ ] **MOD-05**: Writes are guarded by allowlists and explicit user intent (no implicit "fix everything" pushes).

### Write Guardrails (Safety + Control)

- [ ] **SAFE-01**: Deny-by-default for writes unless the mention explicitly requests a change (review-only remains default).
- [ ] **SAFE-02**: Configurable file/path allow/deny rules for modifications (e.g. deny `.github/`, infra, secrets-like files).
- [ ] **SAFE-03**: Never commit suspected secrets; detect common secret patterns and block with a user-visible explanation.
- [ ] **SAFE-04**: Rate limit / concurrency controls for write operations (per installation).
- [ ] **SAFE-05**: Ensure the bot cannot modify its own generated tracking markers in a way that defeats idempotency.

### Durability + Idempotency

- [ ] **DUR-01**: Stronger locking to avoid double-execution across concurrent deliveries for the same PR + action.
- [ ] **DUR-02**: Durable execution identity for write operations (one request -> one branch/PR outcome).
- [ ] **DUR-03**: Replays/redeliveries remain safe (no duplicate commits/PR spam).

### Operator Evidence + Diagnostics

- [ ] **OPS-10**: Evidence bundle for incidents: deliveryId, installation, repo, PR, triggering comment, branch/commit/PR URLs.
- [ ] **OPS-11**: Improve ability to capture GitHub delivery metadata (when available) and link it to logs.
- [ ] **OPS-12**: Runbooks updated for write-mode operations (how to debug failures safely).

## Non-Goals (Still Out of Scope)

- Marketplace listing / public onboarding
- Multi-LLM support
- Broad repo refactors without explicit, narrow intent
- Automatic merges

## Success Criteria

- A maintainer can ask for a small, concrete code change and receive a PR/commit as output.
- The system refuses unsafe write requests with clear reasons and next steps.
- Operators can fully reconstruct what happened from deliveryId-correlated logs and links.
