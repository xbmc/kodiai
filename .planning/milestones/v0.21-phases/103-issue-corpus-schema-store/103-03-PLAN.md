---
phase: 103-issue-corpus-schema-store
plan: 03
type: execute
wave: 3
depends_on: [02]
files_modified:
  - src/knowledge/index.ts
  - src/index.ts
autonomous: true
requirements: [ICORP-02]

must_haves:
  truths:
    - IssueStore factory and types are exported from src/knowledge/index.ts
    - IssueStore is instantiated in src/index.ts after migrations
    - IssueStore is NOT wired into createRetriever (deferred to v0.22)
  artifacts:
    - src/knowledge/index.ts (modified)
    - src/index.ts (modified)
  key_links:
    - knowledge/index.ts exports createIssueStore and all issue types
    - index.ts creates issueStore instance with { sql, logger }
---

<objective>
Wire the IssueStore into the application — export from knowledge barrel and instantiate in index.ts.

Purpose: Makes the issue store available for Phase 105 triage agent wiring.
Output: Modified index.ts and knowledge/index.ts with issue store exports and initialization.
</objective>

<execution_context>
@/home/keith/.claude/get-shit-done/workflows/execute-plan.md
@/home/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/103-issue-corpus-schema-store/103-02-SUMMARY.md

<interfaces>
From src/knowledge/index.ts (current exports, append to this pattern):
```typescript
// Review comment store
export { createReviewCommentStore } from "./review-comment-store.ts";
export type { ReviewCommentStore, ... } from "./review-comment-types.ts";

// Wiki page store
export { createWikiPageStore } from "./wiki-store.ts";
export type { WikiPageStore, ... } from "./wiki-types.ts";

// Code snippet store
export { createCodeSnippetStore } from "./code-snippet-store.ts";
export type { CodeSnippetStore, ... } from "./code-snippet-types.ts";
```

From src/index.ts (store initialization pattern):
```typescript
// Review comment store (v0.18 KI-04)
const reviewCommentStore = createReviewCommentStore({ sql, logger });
logger.info("Review comment store initialized (PostgreSQL + pgvector)");

// Wiki page store (v0.18 KI-10)
const wikiPageStore = createWikiPageStore({ sql, logger });
logger.info("Wiki page store initialized (PostgreSQL + pgvector)");

// Code snippet store (v0.19 SNIP-01)
const codeSnippetStore = createCodeSnippetStore({ sql, logger });
logger.info("Code snippet store initialized (PostgreSQL + pgvector)");
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add issue store exports to knowledge barrel</name>
  <files>src/knowledge/index.ts</files>
  <action>
Add issue store exports to `src/knowledge/index.ts`, following the exact pattern used for review comments, wiki, and code snippets. Add after the code snippet exports section:

```typescript
// Issue store
export { createIssueStore } from "./issue-store.ts";

// Issue types
export type {
  IssueStore, IssueRecord, IssueInput, IssueSearchResult,
  IssueCommentRecord, IssueCommentInput, IssueCommentSearchResult,
} from "./issue-types.ts";
```

Do NOT add issue retrieval functions (no searchIssues equivalent) — cross-corpus retrieval is deferred to v0.22.
  </action>
  <verify>
    <automated>grep "createIssueStore" src/knowledge/index.ts && grep "IssueStore" src/knowledge/index.ts && echo "PASS" || echo "FAIL"</automated>
  </verify>
  <done>knowledge/index.ts exports createIssueStore and all issue types.</done>
</task>

<task type="auto">
  <name>Task 2: Instantiate IssueStore in index.ts</name>
  <files>src/index.ts</files>
  <action>
Add issue store initialization to `src/index.ts`:

1. Add import: add `createIssueStore` to the import from `./knowledge/issue-store.ts` (or from the barrel `./knowledge/index.ts` if that's how the other stores are imported — check the actual imports).

2. After the code snippet store initialization line (`const codeSnippetStore = createCodeSnippetStore...`), add:
```typescript
// Issue store (v0.21 ICORP-02)
const issueStore = createIssueStore({ sql, logger });
logger.info("Issue store initialized (PostgreSQL + pgvector)");
```

3. Do NOT pass issueStore to `createRetriever()` — issue corpus is NOT wired into cross-corpus retrieval yet (deferred to v0.22 per requirements out-of-scope).

4. The `issueStore` variable needs to be available for Phase 105 to consume. Check how other stores are passed to handlers (e.g., mention handler, review handler). If stores are passed via a deps object or context, add issueStore there. If they're used directly in the same file, just ensure the variable is declared in the right scope.

Look at how `reviewCommentStore` is referenced later in index.ts — if it's passed to handlers or routers, do the same for `issueStore`. If there's no handler to pass it to yet (Phase 105 creates the triage handler), just declare it and log — Phase 105 will wire it.
  </action>
  <verify>
    <automated>grep "issueStore" src/index.ts && grep "createIssueStore" src/index.ts && echo "PASS" || echo "FAIL"</automated>
  </verify>
  <done>IssueStore is instantiated in index.ts after migrations, available for Phase 105 triage agent wiring. Not wired into cross-corpus retrieval (intentionally deferred).</done>
</task>

</tasks>

<verification>
- [ ] `grep createIssueStore src/knowledge/index.ts` — export exists
- [ ] `grep IssueStore src/knowledge/index.ts` — type export exists
- [ ] `grep issueStore src/index.ts` — store instantiated
- [ ] `grep -v issueStore src/index.ts | grep createRetriever` — issueStore NOT passed to retriever
- [ ] `bun run build` or `bun typecheck` passes without errors
- [ ] Existing tests still pass: `bun test` (no regressions)
</verification>

<success_criteria>
IssueStore is exported from the knowledge barrel and instantiated in the application entry point. It is NOT wired into cross-corpus retrieval (deferred to v0.22). The application compiles and existing tests pass.
</success_criteria>

<output>
After completion, create `.planning/phases/103-issue-corpus-schema-store/103-03-SUMMARY.md`
</output>
