# Roadmap: Kodiai v0.20 Multi-Model & Active Intelligence

## Overview

v0.20 adds four interconnected intelligence capabilities: task-based multi-LLM routing via Vercel AI SDK (foundation for all non-agentic LLM calls), contributor profiles with cross-platform identity linking, automated wiki staleness detection with evidence-backed reports, and emergent review pattern clustering via HDBSCAN. The model router is the architectural linchpin -- wiki staleness analysis and cluster labeling both depend on it. Contributor profiles are independent and can execute in parallel with routing. Pattern clustering carries the highest technical risk (UMAP dimensionality reduction, Python sidecar) and executes last.

## Phases

- [ ] **Phase 97: Multi-LLM Routing & Cost Tracking** - Vercel AI SDK integration with task-based model routing, provider config, and per-invocation cost logging
- [ ] **Phase 98: Contributor Profiles & Identity Linking** - GitHub/Slack identity linking with expertise inference and adaptive review behavior
- [ ] **Phase 99: Wiki Staleness Detection** - Two-tier staleness scoring with file-path evidence and scheduled reports to Slack or GitHub
- [ ] **Phase 100: Review Pattern Clustering** - HDBSCAN-based emergent theme discovery with UMAP reduction and pattern injection into PR reviews

## Phase Details

### Phase 97: Multi-LLM Routing & Cost Tracking
**Goal**: Non-agentic tasks route through configurable models via Vercel AI SDK while agentic tasks remain on Claude Agent SDK, with full cost visibility per invocation
**Depends on**: Nothing (foundation phase)
**Requirements**: LLM-01, LLM-02, LLM-03, LLM-04, LLM-05
**Success Criteria** (what must be TRUE):
  1. A non-agentic task (e.g., generating a summary label) completes via Vercel AI SDK `generateText()` using the configured model, while PR review and mention handling still use Claude Agent SDK `query()`
  2. Changing the `models:` section in `.kodiai.yml` causes the specified task type to route to a different model on next invocation
  3. When a configured provider is unavailable, the task falls back to the default model and completes successfully
  4. Every non-agentic LLM call produces a row in Postgres with model ID, provider, task type, token counts, and estimated USD cost
**Plans**: TBD

Plans:
- [ ] 97-01: TBD
- [ ] 97-02: TBD
- [ ] 97-03: TBD

### Phase 98: Contributor Profiles & Identity Linking
**Goal**: Contributors have cross-platform profiles with expertise scores that adapt Kodiai's review depth and tone
**Depends on**: Nothing (independent of Phase 97)
**Requirements**: PROF-01, PROF-02, PROF-03, PROF-04, PROF-05
**Success Criteria** (what must be TRUE):
  1. A contributor's GitHub username and Slack user ID are linked via an explicit Slack command (`!kodiai link @github-user`) and the link is visible and unlinkable from both platforms
  2. A contributor's expertise topics and scores are derived from their commit history, review comment patterns, and language usage -- never manually entered
  3. A high-tenure contributor reviewing code in their expertise area receives a terser, higher-signal review than a first-time contributor on the same PR
  4. A contributor with privacy opt-out has no profile built and receives default (non-adaptive) review behavior
**Plans**: TBD

Plans:
- [ ] 98-01: TBD
- [ ] 98-02: TBD
- [ ] 98-03: TBD

### Phase 99: Wiki Staleness Detection
**Goal**: Kodiai automatically identifies wiki pages invalidated by code changes and delivers evidence-backed staleness reports on schedule
**Depends on**: Phase 97 (model router needed for LLM staleness evaluation)
**Requirements**: WIKI-01, WIKI-02, WIKI-03, WIKI-04, WIKI-05
**Success Criteria** (what must be TRUE):
  1. A scheduled job computes staleness scores for wiki pages by comparing their content references against recent code changes, and the scores reflect actual code-wiki divergence
  2. Each flagged stale page includes specific file-path-level evidence: which code files changed, which commit SHAs, and what wiki content they invalidate
  3. A staleness report listing top-N stale pages with evidence is delivered on schedule to Slack `#kodiai` or as a GitHub issue
  4. The staleness threshold is configurable via `.kodiai.yml` `wiki.staleness_threshold_days` and changing it adjusts which pages appear in reports
  5. The two-tier approach runs a cheap heuristic pass first and only sends flagged pages (capped at 20/cycle) to LLM evaluation, keeping per-cycle cost bounded
**Plans**: TBD

Plans:
- [ ] 99-01: TBD
- [ ] 99-02: TBD
- [ ] 99-03: TBD

### Phase 100: Review Pattern Clustering
**Goal**: Kodiai discovers emergent review themes from 18 months of review comment embeddings and surfaces recurring patterns in PR reviews
**Depends on**: Phase 97 (model router needed for cluster label generation)
**Requirements**: CLST-01, CLST-02, CLST-03, CLST-04, CLST-05
**Success Criteria** (what must be TRUE):
  1. A batch clustering job processes review comment embeddings with UMAP dimensionality reduction followed by HDBSCAN and produces labeled clusters without predefined categories
  2. Cluster labels are auto-generated from representative samples via cheap LLM (e.g., Haiku) and are human-readable theme descriptions, not numeric IDs
  3. When a PR touches code related to a cluster with 3+ members in the last 60 days, the review includes a "Recurring patterns" callout citing the theme
  4. Cluster assignments, labels, and centroids are persisted in Postgres and refreshed on a weekly schedule
**Plans**: TBD

Plans:
- [ ] 100-01: TBD
- [ ] 100-02: TBD
- [ ] 100-03: TBD

## Progress

**Execution Order:** 97 -> 98 -> 99 -> 100

| Phase | Plans Complete | Status | Completed |
|-------|----------------|--------|-----------|
| 97. Multi-LLM Routing & Cost Tracking | 0/TBD | Not started | - |
| 98. Contributor Profiles & Identity Linking | 0/TBD | Not started | - |
| 99. Wiki Staleness Detection | 0/TBD | Not started | - |
| 100. Review Pattern Clustering | 0/TBD | Not started | - |

---

*Roadmap created: 2026-02-25*
