---
phase: 81-slack-write-mode-enablement
plan: 04
type: execute
wave: 4
depends_on: [81-03]
files_modified:
  - scripts/phase81-slack-write-smoke.ts
  - scripts/phase81-slack-write-smoke.test.ts
  - scripts/phase81-slack-write-regression-gate.ts
  - scripts/phase81-slack-write-regression-gate.test.ts
  - package.json
  - docs/runbooks/slack-integration.md
autonomous: true

must_haves:
  truths:
    - "Operators can run a deterministic Phase 81 smoke check that verifies write-intent routing, ambiguous fallback, and high-impact confirmation behavior"
    - "Operators can run a deterministic Phase 81 regression gate that fails non-zero on Slack write contract drift"
    - "Runbook instructions map Phase 81 verification commands to machine-checkable check IDs and troubleshooting guidance"
  artifacts:
    - path: "scripts/phase81-slack-write-smoke.ts"
      provides: "Deterministic Phase 81 smoke verifier with machine-checkable IDs"
      contains: "SLK81-SMOKE"
    - path: "scripts/phase81-slack-write-regression-gate.ts"
      provides: "Deterministic Phase 81 regression gate that pins contract suites and exits non-zero on failures"
      contains: "SLK81-REG"
    - path: "docs/runbooks/slack-integration.md"
      provides: "Phase 81 operator verification and incident triage instructions"
      contains: "verify:phase81:smoke|verify:phase81:regression"
  key_links:
    - from: "scripts/phase81-slack-write-regression-gate.ts"
      to: "src/slack/assistant-handler.test.ts"
      via: "Regression gate executes pinned Slack write contract suites"
      pattern: "SLK81-REG"
    - from: "docs/runbooks/slack-integration.md"
      to: "package.json"
      via: "Runbook commands reference stable package aliases for smoke and regression verification"
      pattern: "verify:phase81:smoke|verify:phase81:regression"
---

<objective>
Add deterministic operator verification gates and runbook updates for Slack write mode so Phase 81 can be validated and release-blocking in CI/operator workflows.

Purpose: After confirmation and UX contracts are implemented, operators need stable smoke/regression checks and documentation to detect drift quickly.
Output: Phase 81 smoke/regression scripts and tests, package command aliases, and runbook updates.
</objective>

<execution_context>
@/home/keith/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/keith/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/81-slack-write-mode-enablement/81-CONTEXT.md
@.planning/phases/81-slack-write-mode-enablement/81-03-SUMMARY.md
@.planning/phases/80-slack-operator-hardening/80-01-SUMMARY.md
@.planning/phases/80-slack-operator-hardening/80-02-SUMMARY.md
@docs/runbooks/slack-integration.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Phase 81 deterministic smoke verifier with stable package command</name>
  <files>scripts/phase81-slack-write-smoke.ts, scripts/phase81-slack-write-smoke.test.ts, package.json</files>
  <action>
Create `phase81-slack-write-smoke` checks (for example `SLK81-SMOKE-*`) that run deterministically offline and verify core Slack write behavior:

- Explicit write-intent routing enters write-capable flow.
- Ambiguous conversational intent remains read-only and emits quick-action rerun guidance.
- High-impact confirmation gating path is recognized.
- Success/refusal output contract basics remain intact.
- Add and test a stable package alias (for example `verify:phase81:smoke`) for operator use.
  </action>
  <verify>
Run `bun test ./scripts/phase81-slack-write-smoke.test.ts --timeout 30000`.
Run `bun run verify:phase81:smoke`.
  </verify>
  <done>
Operators can execute one deterministic smoke command that emits machine-checkable Phase 81 smoke IDs and fails when key Slack write behavior drifts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add regression gate command and update Slack runbook for Phase 81 rollout</name>
  <files>scripts/phase81-slack-write-regression-gate.ts, scripts/phase81-slack-write-regression-gate.test.ts, package.json, docs/runbooks/slack-integration.md</files>
  <action>
Ship release-blocking regression and operator documentation for Phase 81:

- Create `phase81-slack-write-regression-gate` checks (for example `SLK81-REG-*`) that execute pinned local suites and exit non-zero on contract drift.
- Add and test a stable package alias (for example `verify:phase81:regression`) used by operators/CI.
- Update `docs/runbooks/slack-integration.md` with Phase 81 rollout checks, failure interpretation, and troubleshooting for write mode.
- Keep gate deterministic and offline (no live Slack dependency).
  </action>
  <verify>
Run `bun test ./scripts/phase81-slack-write-regression-gate.test.ts --timeout 30000`.
Run `bun run verify:phase81:regression`.
  </verify>
  <done>
Phase 81 has a deterministic regression command and runbook-backed operational workflow that blocks rollout when Slack write-mode contracts regress.
  </done>
</task>

</tasks>

<verification>
- Phase 81 smoke and regression commands emit machine-checkable pass/fail IDs and non-zero exits on failures.
- Package aliases run the expected scripts locally without extra flags.
- Runbook documents Phase 81 verification and incident triage flow for write mode.
</verification>

<success_criteria>
Operators can deterministically verify and gate Slack write-mode rollout via documented smoke/regression commands that fail fast on contract drift.
</success_criteria>

<output>
After completion, create `.planning/phases/81-slack-write-mode-enablement/81-04-SUMMARY.md`
</output>
