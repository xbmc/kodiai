# Roadmap: v0.21 Issue Triage Foundation

## Overview

Stand up the issue vector corpus, build GitHub MCP tools for agent-driven issue interaction, and deliver a `@kodiai`-triggered triage agent that validates issue templates and applies labels when fields are missing. Three phases: schema/store and MCP tools are independent (parallelizable), then the triage agent wires everything together.

## Phases

**Phase Numbering:**
- Integer phases (103, 104, 105): Planned milestone work
- Decimal phases (e.g., 103.1): Urgent insertions (marked with INSERTED)

- [ ] **Phase 103: Issue Corpus Schema & Store** - PostgreSQL issue table with HNSW/tsvector indexes and typed store interface
- [ ] **Phase 104: Issue MCP Tools** - `github_issue_label` and `github_issue_comment` MCP servers wired into executor registry
- [ ] **Phase 105: Triage Agent Wiring** - Template parser, triage agent, and mention handler integration with config gating

## Phase Details

### Phase 103: Issue Corpus Schema & Store
**Goal**: Issues have a dedicated vector corpus in PostgreSQL with the same search infrastructure as existing corpora
**Depends on**: Nothing (independent of Phase 104)
**Requirements**: ICORP-01, ICORP-02
**Success Criteria** (what must be TRUE):
  1. Migration 014 creates `issues` table with HNSW vector index (cosine, m=16) and tsvector GIN index matching existing corpus conventions
  2. `IssueStore` provides typed CRUD (upsert, delete, getByNumber) and hybrid search (vector + BM25) matching the `ReviewCommentStore` interface pattern
  3. Schema includes all metadata columns needed by the triage agent: `state`, `author_association`, `label_names`, `template_slug`, `comment_count`
**Plans**: TBD

### Phase 104: Issue MCP Tools
**Goal**: The triage agent has MCP tools to apply labels and post comments on GitHub issues
**Depends on**: Nothing (independent of Phase 103)
**Requirements**: MCPT-01, MCPT-02, MCPT-03
**Success Criteria** (what must be TRUE):
  1. `github_issue_label` MCP tool applies labels to issues, validates label existence, and returns available labels on 404 instead of crashing
  2. `github_issue_comment` MCP tool posts comments on issues without review-specific validators that would reject issue content
  3. Both tools are registered in `buildMcpServers()` with config gating and have integration tests verifying the Octokit API calls
**Plans**: TBD

### Phase 105: Triage Agent Wiring
**Goal**: When a maintainer mentions `@kodiai` on an issue, the bot validates the issue body against the repo's template, comments with specific missing-field guidance, and applies a label
**Depends on**: Phase 103, Phase 104
**Requirements**: TRIA-01, TRIA-02, TRIA-03
**Success Criteria** (what must be TRUE):
  1. Template parser reads `.md` templates from `.github/ISSUE_TEMPLATE/`, extracts required sections, and diffs against the issue body to identify missing fields
  2. Triage agent generates a structured guidance comment listing specific missing fields and applies the configured label (e.g., `Ignored rules`) when template validation fails
  3. Triage is wired to the `@kodiai` mention path for issues only (not PRs), gated by `.kodiai.yml` `triage.enabled` (default disabled), with a per-issue cooldown preventing comment spam
  4. Bot self-loop prevention is verified: triage does not re-trigger on its own comments, and `pull_request` field guard prevents triage from firing on PR comments
**Plans**: TBD

## Progress

**Execution Order:**
Phases 103 and 104 are independent and can execute in either order. Phase 105 requires both.

| Phase | Plans Complete | Status | Completed |
|-------|----------------|--------|-----------|
| 103. Issue Corpus Schema & Store | 0/TBD | Not started | - |
| 104. Issue MCP Tools | 0/TBD | Not started | - |
| 105. Triage Agent Wiring | 0/TBD | Not started | - |

---

*Roadmap created: 2026-02-26*
